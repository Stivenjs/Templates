version: 1
applications:
  - appRoot: apps/Ninico
    frontend:
      phases:
        preBuild:
          commands:
            - CHANGED=$(git diff --name-only HEAD^ HEAD | grep '^apps/Ninico/' | wc -l)
            - if [ "$CHANGED" -gt 0 ]; then npm install; fi
        build:
          commands:
            - if [ "$CHANGED" -gt 0 ]; then npm run build; fi
      artifacts:
        baseDirectory: .next
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*

  - appRoot: apps/Anvogue
    frontend:
      phases:
        preBuild:
          commands:
            - CHANGED=$(git diff --name-only HEAD^ HEAD | grep '^apps/Anvogue/' | wc -l)
            - if [ "$CHANGED" -gt 0 ]; then npm install; fi
        build:
          commands:
            - if [ "$CHANGED" -gt 0 ]; then npm run build; fi
      artifacts:
        baseDirectory: .next
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
